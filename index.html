<!doctype html>
<html lang="en">
	<head>
	  <meta charset="utf-8" />
	  <meta name="viewport" content="width=device-width,initial-scale=1" />
	  <title>TESTING SVG</title>
	</head>
	<body>
	  <div id="stage" role="region">
		
		<!-- Display an initial SVG -->
		<object id= "svgObj" data="2-000-800-A.svg" type="image/svg+xml"></object>

		<!-- Menu with direct links to the other files -->
		<nav class="menu" aria-label="Related drawings">
		  <span class="label">Open:</span>
		  	<a href="2-000-801-A.svg">801-A</a>
		  	<a href="2-000-893-A.svg">893-A</a>
		  	<a href="2-001-799-A.svg">799-A</a>
		</nav>

		  <!-- output for the 'ordering' table' -->
		 <div id="tableOut" aria-live="polite"></div>

		  <div id="cart">
			
		  </div>
	  </div>

		<!-- script to get the table of products -->
	   <script>
		   
		  const obj = document.getElementById('svgObj');
		  const out = document.getElementById('tableOut');

		   // When clicking the navigation links, load the data into the 'svgObj' rather than opening a new tab
		  document.querySelector('.menu').addEventListener('click', (e) => {
		    const a = e.target.closest('a');
		    if (!a) return;
		    e.preventDefault();
		    obj.data = a.getAttribute('href');
		  });
		   
		  // When SVG loads into 'objSvg' check that the the content is valid svg file
		  obj.addEventListener('load', () => {
		    const svgDoc = obj.contentDocument || obj.getSVGDocument?.();
		    if (svgDoc && svgDoc.documentElement?.tagName.toLowerCase() === 'svg') {
		      handleSvgDoc(svgDoc);
		    }
		  });

			// extract each rows information useing the Line#
		  function handleSvgDoc(svgDoc) {
		    // Collect rows: all groups whose id starts with "Line"
		    let groups = [...svgDoc.querySelectorAll('g[id^="Line"]')];
		
		    // Put Line1, Line2, ... in order
		    groups.sort((a, b) => (parseInt(a.id.match(/\d+/)) || 0) - (parseInt(b.id.match(/\d+/)) || 0));
		
		    // Extract each cell text in order of appearance inside the group
		    const rows = groups.map(g => [...g.querySelectorAll('text')].map(t => t.textContent.trim()));

		    renderTable(rows);
		  }

			// build HTML table using the rows of Line#
		  function renderTable(rows) {
		    if (!rows.length) {
		      out.textContent = 'No Line* groups with <text> found.';
		      return;
		    }
		
		    let html = '<table>';
		
			html += '<thead><tr><th>ITEM NO.</th><th>PART NUMBER</th><th>DESCRIPTION</th><th>QTY</th><th>ORDER QTY</th></tr></thead>'
		    html += '<tbody>';
		    for (const r of rows) {
		      html += '<tr>' + r.map(c => `<td>${escapeHtml(c)}</td>`).join('') + '<td><input type="number"></td>' + '</tr>';
		    }
		    html += '</tbody></table>';
		
		    out.innerHTML = html;
		  }

		// convert svg tags to valid html tags
		  function escapeHtml(s) {
		    return s.replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
		  }
	  </script>
	</body>
</html>
























